<div style="display: none;">
    <img src="<{$action_url}>&a=1"/>
</div>
<script type="text/javascript">
    document.body.onclick = function (e) {
        var screen = '';
        if (e.pageX && e.pageY) {
            screen = '&x=' + parseInt((e.pageX * 10000) / document.body.clientWidth) + '&y=' + parseInt((e.pageY * 10000) / document.body.clientHeight);
        }
        var ele = document.createElement("img");
        ele.src = '<{$action_url}>&a=2' + screen;
        var timer = setInterval(function () {
            if (ele.complete) {
                window.location.href = window.download_href;
                clearInterval(timer);
            }
        }, 50);
        return false;
    };

    var elements = document.getElementsByTagName('a');
    for (var i = 0; i < elements.length; i++) {
        if (typeof elements[i].onclick == 'function') {
            continue;
        }

        elements[i].onclick = function (e) {
            var screen = '';
            if (e.pageX && e.pageY) {
                screen = '&x=' + parseInt((e.pageX * 10000) / document.body.clientWidth) + '&y=' + parseInt((e.pageY * 10000) / document.body.clientHeight);
            }
            var ele = document.createElement("img");
            ele.src = '<{$action_url}>&a=2' + screen;
            e.stopPropagation();
        }
    }
</script>